"""CVE-2024-21887 - Ivanti Connect Secure Command Injection RCE"""

from dataclasses import dataclass
from typing import List
from datetime import datetime


@dataclass
class CVEMetadata:
    cve_id: str
    title: str
    description: str
    severity: str
    cvss_score: float
    published_date: datetime
    affected_products: List[str]
    references: List[str]
    def to_dict(self): return {'cveId': self.cve_id, 'title': self.title, 'description': self.description, 'severity': self.severity, 'cvssScore': str(self.cvss_score), 'publishedDate': self.published_date.isoformat(), 'affectedProducts': self.affected_products, 'references': self.references}


@dataclass
class ToolMetadata:
    tool_name: str
    version: str
    exploit_name: str
    language: str
    author: str
    website: str
    profile: str
    def to_dict(self): return {'name': self.tool_name, 'version': self.version, 'exploitName': self.exploit_name, 'language': self.language, 'author': self.author}


CVE = CVEMetadata(
    cve_id="CVE-2024-21887",
    title="Ivanti Connect Secure Command Injection",
    description="Critical unauthenticated command injection vulnerability in Ivanti Connect Secure allowing attackers to execute commands on the web interface.",
    severity="CRITICAL",
    cvss_score=9.1,
    published_date=datetime(2024, 1, 31),
    affected_products=["Ivanti Connect Secure 9.x", "Ivanti Connect Secure 22.x", "Ivanti Policy Secure 9.x", "Ivanti Policy Secure 22.x"],
    references=["https://nvd.nist.gov/vuln/detail/CVE-2024-21887", "https://www.ivanti.com/security-advisories"]
)

TOOL = ToolMetadata(
    tool_name="CVE-2024-21887 Ivanti Exploit",
    version="1.0",
    exploit_name="IvantiShell",
    language="python",
    author="Moovendhan V",
    website="www.cybertechmind.com",
    profile="profile.cybertechmind.com"
)

ASCII_ART = """
▀█ █ █ ▄▀▄ █▄ █ ▀█▀ ▀█  ▄▀▀ █▄█ ██▀ █   █  
▄█ ▀▄▀ █▀█ █ ▀█  █  ▄█▌ ▄██ █ █ █▄▄ █▄▄ █▄▄
"""

USAGE_EXAMPLES = """
Examples:
  exploit.py -t https://vpn.company.com -c "whoami"
  exploit.py -t https://ivanti.target.com -c "id"
"""

POC_METADATA = {
    'name': 'IvantiShell - CVE-2024-21887 Exploit',
    'description': 'Exploits command injection in Ivanti Connect Secure web interface for unauthenticated RCE.',
    'language': 'python',
    'usageExamples': USAGE_EXAMPLES.strip(),
    'author': TOOL.author
}

EXPLOIT_CONFIG = {'timeout': 15, 'default_protocol': 'https', 'injection_endpoint': '/api/v1/totp/user-backup-code/', 'verify_ssl': False}

__all__ = ['CVE', 'TOOL', 'ASCII_ART', 'POC_METADATA', 'EXPLOIT_CONFIG']

def get_full_metadata():
    return {'cve': CVE.to_dict(), 'tool': TOOL.to_dict(), 'poc': POC_METADATA, 'config': EXPLOIT_CONFIG}
