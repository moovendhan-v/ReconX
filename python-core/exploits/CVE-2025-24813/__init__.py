"""
CVE-2025-24813 - Apache Tomcat Deserialization RCE
Exploit configuration and metadata

This module contains all the configuration and metadata for the CVE-2025-24813 exploit.
Import this module to access CVE details, tool information, and ASCII art.
"""

from dataclasses import dataclass
from typing import List, Optional
from datetime import datetime


@dataclass
class CVEMetadata:
    """CVE vulnerability metadata"""
    cve_id: str
    title: str
    description: str
    severity: str  # LOW, MEDIUM, HIGH, CRITICAL
    cvss_score: float
    published_date: datetime
    affected_products: List[str]
    references: List[str]
    
    def to_dict(self):
        """Convert to dictionary for API/database usage"""
        return {
            'cveId': self.cve_id,
            'title': self.title,
            'description': self.description,
            'severity': self.severity,
            'cvssScore': str(self.cvss_score),
            'publishedDate': self.published_date.isoformat(),
            'affectedProducts': self.affected_products,
            'references': self.references
        }


@dataclass
class ToolMetadata:
    """Exploit tool metadata"""
    tool_name: str
    version: str
    exploit_name: str
    language: str
    author: str
    website: str
    profile: str
    
    def to_dict(self):
        """Convert to dictionary for API/database usage"""
        return {
            'name': self.tool_name,
            'version': self.version,
            'exploitName': self.exploit_name,
            'language': self.language,
            'author': self.author
        }


# CVE Information
CVE = CVEMetadata(
    cve_id="CVE-2025-24813",
    title="Apache Tomcat Deserialization Remote Code Execution",
    description=(
        "A critical unauthenticated remote code execution vulnerability in Apache Tomcat "
        "that leverages deserialization through its partial PUT feature. The vulnerability "
        "allows attackers to upload malicious serialized payloads via HTTP PUT requests, "
        "which are then deserialized when specific non-default configurations are met, "
        "resulting in arbitrary code execution on the server."
    ),
    severity="CRITICAL",
    cvss_score=9.0,
    published_date=datetime(2025, 3, 10),
    affected_products=[
        "Apache Tomcat 11.0.0-M1 through 11.0.2",
        "Apache Tomcat 10.1.0-M1 through 10.1.34",
        "Apache Tomcat 9.0.0.M1 through 9.0.98",
        "Apache Tomcat 8.5.0 through 8.5.100 (EOL)"
    ],
    references=[
        "https://nvd.nist.gov/vuln/detail/CVE-2025-24813",
        "https://tomcat.apache.org/security-9.html",
        "https://github.com/advisories/GHSA-tomcat-2025-24813"
    ]
)


# Tool Information
TOOL = ToolMetadata(
    tool_name="CVE-2025-24813 Tomcat Deser Exploit",
    version="1.0",
    exploit_name="TomcatShell",
    language="python",
    author="Moovendhan V",
    website="www.cybertechmind.com",
    profile="profile.cybertechmind.com"
)


# ASCII Art Banner
ASCII_ART = """
▀█▀ ▄▀▄ █▄ ▄█ ▄▀▀ ▄▀▄ ▀█▀ ▄▀▀ █▄█ ██▀ █   █  
 █  ▀▄▀ █ ▀ █ ▀▄▄ █▀█  █  ▄██ █ █ █▄▄ █▄▄ █▄▄
"""


# Usage Examples
USAGE_EXAMPLES = """
Examples:
  exploit.py -t http://target.com:8080 -c "whoami"
  exploit.py -t http://target.com:8080 -c "id"
  exploit.py -t http://target.com:8080 -c "cat /etc/passwd"
  exploit.py -t http://localhost:8080 -c "ps aux"
  exploit.py -t http://vulnerable-tomcat.com -c "uname -a"
"""


# POC Database Entry (for seeding)
POC_METADATA = {
    'name': 'TomcatShell - CVE-2025-24813 Exploit',
    'description': (
        'Automated exploitation tool for CVE-2025-24813. Exploits unsafe deserialization '
        'in Apache Tomcat by uploading malicious serialized session files via partial PUT '
        'requests, then triggering deserialization to achieve remote code execution.'
    ),
    'language': 'python',
    'usageExamples': USAGE_EXAMPLES.strip(),
    'author': TOOL.author
}


# Exploitation Configuration
EXPLOIT_CONFIG = {
    'timeout': 20,  # seconds
    'default_protocol': 'http',
    'content_range_header': 'bytes 0-*/0',
    'user_agent_template': '{author}-Scanner/{version} ({website})',
    'max_retries': 3,
    'verify_ssl': False,
    'session_id_length': 32
}


# Export all configurations
__all__ = [
    'CVE',
    'TOOL', 
    'ASCII_ART',
    'USAGE_EXAMPLES',
    'POC_METADATA',
    'EXPLOIT_CONFIG',
    'CVEMetadata',
    'ToolMetadata'
]


# Convenience function to get all metadata as dict
def get_full_metadata():
    """Get complete metadata for platform integration"""
    return {
        'cve': CVE.to_dict(),
        'tool': TOOL.to_dict(),
        'poc': POC_METADATA,
        'config': EXPLOIT_CONFIG
    }
