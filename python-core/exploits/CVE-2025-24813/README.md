# CVE-2025-24813 - Apache Tomcat Deserialization RCE

## Vulnerability Overview

**CVE ID**: CVE-2025-24813  
**Severity**: CRITICAL (CVSS 9.0)  
**Attack Vector**: Network  
**Attack Complexity**: Low  
**Privileges Required**: None  
**User Interaction**: None

## Description

A critical unauthenticated remote code execution vulnerability in Apache Tomcat that exploits unsafe deserialization through the partial PUT feature. When specific non-default configurations are present, attackers can upload malicious serialized payloads that are later deserialized, resulting in arbitrary code execution.

## Affected Versions

- Apache Tomcat 11.0.0-M1 through 11.0.2
- Apache Tomcat 10.1.0-M1 through 10.1.34
- Apache Tomcat 9.0.0.M1 through 9.0.98
- Apache Tomcat 8.5.0 through 8.5.100 (End-of-Life)

## Exploitation Requirements

The target server must have ALL of the following configurations:

1. ✅ Writes enabled for the default servlet (disabled by default)
2. ✅ Support for partial PUT enabled (enabled by default) 
3. ✅ File-based session persistence with default storage location (disabled by default)
4. ✅ A gadget chain library present (e.g., Commons Collections)

## How It Works

### Two-Step Exploitation Process

**Step 1: Payload Upload**
- Craft a malicious serialized Java object using gadget chains
- Upload the payload via HTTP PUT request with `Content-Range` header
- Payload overwrites session file on disk

**Step 2: Deserialization Trigger**
- Send HTTP GET request with session cookie (`JSESSIONID`)
- Server deserializes the malicious session file
- Gadget chain executes arbitrary commands

## Usage

### Basic Syntax

```bash
python exploit.py -t <target> -c <command>
```

### Examples

```bash
# Execute whoami command
python exploit.py -t http://target.com:8080 -c "whoami"

# Get user ID
python exploit.py -t http://localhost:8080 -c "id"

# Read passwd file
python exploit.py -t http://vulnerable-tomcat.com -c "cat /etc/passwd"

# List processes
python exploit.py -t http://target.com:8080 -c "ps aux"

# Get system info
python exploit.py -t http://target.com:8080 -c "uname -a"
```

### Arguments

- `-t, --target`: Target Tomcat server URL (required)
- `-c, --command`: Shell command to execute (required)

## Technical Details

### Gadget Chains

This exploit uses deserialization gadget chains from vulnerable libraries:

- **Commons Collections** (most common)
- Commons BeanUtils
- Spring Framework
- Apache Commons FileUpload

### Attack Flow

```
1. Generate malicious serialized payload
   └─> Use gadget chain (e.g., CommonsCollections6)
   └─> Embed command execution logic

2. Upload via PUT request
   └─> Target: /sessions/{SESSION_ID}.session
   └─> Header: Content-Range: bytes 0-*/0
   └─> Body: Serialized payload

3. Trigger deserialization
   └─> Send GET request with JSESSIONID cookie
   └─> Server loads and deserializes session file
   └─> Gadget chain executes → RCE achieved
```

## Remediation

### Immediate Actions

1. **Update Apache Tomcat**:
   - Upgrade to 11.0.3 or later
   - Upgrade to 10.1.35 or later  
   - Upgrade to 9.0.99 or later

2. **Disable vulnerable features**:
   ```xml
   <!-- In web.xml, ensure default servlet has readonly=true -->
   <servlet>
       <servlet-name>default</servlet-name>
       <servlet-class>org.apache.catalina.servlets.DefaultServlet</servlet-class>
       <init-param>
           <param-name>readonly</param-name>
           <param-value>true</param-value>
       </init-param>
   </servlet>
   ```

3. **Disable file-based sessions**: Use memory or database-backed sessions

### Long-term Mitigations

- Remove unused gadget chain libraries
- Implement input validation for serialized data
- Use Java Agent-based deserialization filters
- Enable Tomcat's SecurityManager

## Detection

### Log Indicators

```
- PUT requests to /sessions/* paths
- Unusual Content-Range headers
- Serialized Java objects in request bodies
- Server errors during session deserialization
- Suspicious JSESSIONID values
```

### Network Signatures

```
Content-Range: bytes 0-*/0
Content-Type: application/octet-stream
Cookie: JSESSIONID=[A-Z0-9]{32}
```

## References

- [CVE-2025-24813 - NVD](https://nvd.nist.gov/vuln/detail/CVE-2025-24813)
- [Apache Tomcat Security Advisories](https://tomcat.apache.org/security-9.html)
- [OWASP Deserialization Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html)

## Legal Notice

⚠️ **WARNING**: This exploit is for authorized security testing only. Unauthorized access to computer systems is illegal under applicable laws (CFAA, Computer Misuse Act, etc.). Always obtain proper written authorization before conducting security assessments.

## Author

**Moovendhan V**  
Website: www.cybertechmind.com  
Profile: profile.cybertechmind.com

---

*Part of the ReconX Security Testing Platform*
