"""
Banner display utilities for POC exploits
Reusable across all exploit scripts
"""

from typing import Dict, Optional
from .theme import Theme
from .signature import Signature


class BannerDisplay:
    """Handles banner and UI displays for exploit scripts"""
    
    def __init__(self, signature: Signature):
        """
        Initialize banner display with signature
        
        Args:
            signature: Signature instance for branding
        """
        self.signature = signature
    
    def show_header(self, ascii_art: str = "") -> None:
        """
        Display main exploitation framework header
        
        Args:
            ascii_art: Optional ASCII art to display
        """
        print(self.signature.get_banner(ascii_art))
    
    def show_config(self, config: Dict[str, str]) -> None:
        """
        Display exploitation configuration
        
        Args:
            config: Dictionary of configuration key-value pairs
        """
        print(f"\n{Theme.OKBLUE}[*] EXPLOITATION PARAMETERS{Theme.ENDC}")
        print(f"{Theme.DIM}{'─' * 60}{Theme.ENDC}")
        
        for key, value in config.items():
            print(f"{Theme.OKCYAN}  {key.upper():<12}:{Theme.ENDC} {value}")
        
        print(f"{Theme.DIM}{'─' * 60}{Theme.ENDC}\n")
    
    def show_success(self, output: str, title: str = "EXPLOITATION SUCCESSFUL") -> None:
        """
        Display success message with output
        
        Args:
            output: Execution output to display
            title: Success message title
        """
        print(f"\n{Theme.OKGREEN}{Theme.BOLD}[+] {title}{Theme.ENDC}")
        print(f"{Theme.DIM}{'─' * 60}{Theme.ENDC}")
        
        # Process output
        cleaned_output = output.replace(' | ', '\n')
        lines = cleaned_output.split('\n')
        
        for line in lines:
            if line.strip():
                print(f"{Theme.OKGREEN}  ▸{Theme.ENDC} {line}")
        
        print(f"{Theme.DIM}{'─' * 60}{Theme.ENDC}\n")
    
    def show_failure(
        self, 
        error_type: str, 
        details: str = "",
        error_map: Optional[Dict[str, tuple]] = None
    ) -> None:
        """
        Display failure message
        
        Args:
            error_type: Type of error (e.g., 'timeout', 'forbidden')
            details: Additional error details
            error_map: Optional custom error mapping
        """
        if error_map is None:
            error_map = {
                'forbidden': ('ACCESS DENIED', 'WAF/Firewall blocking detected'),
                'timeout': ('CONNECTION TIMEOUT', 'Target did not respond'),
                'ssl': ('SSL ERROR', 'Certificate validation failed - try HTTP'),
                'server_error': ('SERVER ERROR', 'Target rejected payload or not vulnerable'),
                'unknown': ('EXPLOITATION FAILED', 'Target may not be vulnerable')
            }
        
        print(f"\n{Theme.FAIL}{Theme.BOLD}[X] EXPLOITATION FAILED{Theme.ENDC}")
        print(f"{Theme.DIM}{'─' * 60}{Theme.ENDC}")
        
        title, msg = error_map.get(error_type, error_map['unknown'])
        print(f"{Theme.FAIL}  ▸ {title}{Theme.ENDC}")
        print(f"{Theme.WARNING}  ▸ {msg}{Theme.ENDC}")
        
        if details:
            print(f"{Theme.DIM}  ▸ {details}{Theme.ENDC}")
        
        print(f"{Theme.DIM}{'─' * 60}{Theme.ENDC}\n")
    
    def show_info(self, message: str) -> None:
        """
        Display info message
        
        Args:
            message: Info message to display
        """
        print(f"{Theme.OKCYAN}[*] {message}{Theme.ENDC}")
    
    def show_warning(self, message: str) -> None:
        """
        Display warning message
        
        Args:
            message: Warning message to display
        """
        print(f"{Theme.WARNING}[!] {message}{Theme.ENDC}")
